\section{Snippet Library}
\label{app:snippets}

This appendix provides an index of key Lean code snippets referenced throughout the paper. All snippets are shown exactly as they appear in the repository.

\subsection{Core Definitions}

\paragraph{Snippet 1: Exchangeable.}
\begin{lstlisting}
-- Exchangeability/Contractability.lean:81-84
def Exchangeable (μ : Measure Ω) (X : ℕ → Ω → α) : Prop :=
  ∀ n (σ : Equiv.Perm (Fin n)),
    Measure.map (fun ω => fun i : Fin n => X (σ i) ω) μ =
      Measure.map (fun ω => fun i : Fin n => X i ω) μ
\end{lstlisting}

\paragraph{Snippet 2: Contractable.}
\begin{lstlisting}
-- Exchangeability/Contractability.lean:199-202
def Contractable (μ : Measure Ω) (X : ℕ → Ω → α) : Prop :=
  ∀ (m : ℕ) (k : Fin m → ℕ), StrictMono k →
    Measure.map (fun ω i => X (k i) ω) μ =
      Measure.map (fun ω i => X i.val ω) μ
\end{lstlisting}

\paragraph{Snippet 3: ConditionallyIID.}
\begin{lstlisting}
-- Exchangeability/ConditionallyIID.lean:190-196
def ConditionallyIID (μ : Measure Ω) (X : ℕ → Ω → α) : Prop :=
  ∃ ν : Ω → Measure α,
    (∀ ω, IsProbabilityMeasure (ν ω)) ∧
    (∀ B, MeasurableSet B → Measurable (fun ω => ν ω B)) ∧
      ∀ (m : ℕ) (k : Fin m → ℕ), StrictMono k →
        Measure.map (fun ω => fun i : Fin m => X (k i) ω) μ
          = μ.bind (fun ω => Measure.pi fun _ : Fin m => ν ω)
\end{lstlisting}

\subsection{Main Theorems}

\paragraph{Snippet 4: de Finetti's Theorem.}
\begin{lstlisting}
-- Exchangeability/DeFinetti/TheoremViaMartingale.lean:96-103
theorem deFinetti
    [StandardBorelSpace Ω]
    {α : Type*} [MeasurableSpace α] [StandardBorelSpace α] [Nonempty α]
    {μ : Measure Ω} [IsProbabilityMeasure μ]
    (X : ℕ → Ω → α) (hX_meas : ∀ i, Measurable (X i))
    (hX_exch : Exchangeable μ X) :
    ConditionallyIID μ X :=
  conditionallyIID_of_contractable X hX_meas
    (contractable_of_exchangeable hX_exch hX_meas)
\end{lstlisting}

\paragraph{Snippet 5: Full Equivalence.}
\begin{lstlisting}
-- Exchangeability/DeFinetti/TheoremViaMartingale.lean:138-153
theorem deFinetti_RyllNardzewski_equivalence
    [StandardBorelSpace Ω]
    {α : Type*} [MeasurableSpace α] [StandardBorelSpace α] [Nonempty α]
    {μ : Measure Ω} [IsProbabilityMeasure μ]
    (X : ℕ → Ω → α) (hX_meas : ∀ i, Measurable (X i)) :
    Contractable μ X ↔ Exchangeable μ X ∧ ConditionallyIID μ X := by
  constructor
  · intro hContract
    have hCIID := conditionallyIID_of_contractable X hX_meas hContract
    have hExch := exchangeable_of_conditionallyIID hX_meas hCIID
    exact ⟨hExch, hCIID⟩
  · intro ⟨hExch, _⟩
    exact contractable_of_exchangeable hExch hX_meas
\end{lstlisting}

\subsection{Directing Measure}

\paragraph{Snippet 9: Directing Measure Construction.}
\begin{lstlisting}
-- DeFinetti/ViaMartingale/DirectingMeasure.lean:53-58
noncomputable def directingMeasure
    {Ω : Type*} [MeasurableSpace Ω] [StandardBorelSpace Ω]
    {μ : Measure Ω} [IsProbabilityMeasure μ]
    {α : Type*} [MeasurableSpace α] [StandardBorelSpace α] [Nonempty α]
    (X : ℕ → Ω → α) (_hX : ∀ n, Measurable (X n)) (ω : Ω) : Measure α :=
  (ProbabilityTheory.condExpKernel μ (tailSigma X) ω).map (X 0)
\end{lstlisting}

\subsection{Tail $\sigma$-Algebra}

\paragraph{Snippet 12: Tail Shift.}
\begin{lstlisting}
-- Exchangeability/Tail/TailSigma.lean:88-92
def tailShift (α : Type*) [MeasurableSpace α] : MeasurableSpace (ℕ → α) :=
  iInf (fun n : ℕ =>
    MeasurableSpace.comap
      (fun (ω : ℕ → α) => fun k => ω (n + k))
      (inferInstance : MeasurableSpace (ℕ → α)))
\end{lstlisting}

\subsection{Ergodic Theory}

\paragraph{Snippet 13: Koopman Operator.}
\begin{lstlisting}
-- Exchangeability/Ergodic/KoopmanMeanErgodic.lean:120-122
def koopman {μ : Measure Ω} [IsProbabilityMeasure μ]
    (T : Ω → Ω) (hT : MeasurePreserving T μ μ) :
    Lp ℝ 2 μ →L[ℝ] Lp ℝ 2 μ :=
  (MeasureTheory.Lp.compMeasurePreservingₗᵢ ℝ T hT).toContinuousLinearMap
\end{lstlisting}

\paragraph{Snippet 14: Mean Ergodic Theorem.}
\begin{lstlisting}
-- Exchangeability/Ergodic/KoopmanMeanErgodic.lean:245-249
theorem birkhoffAverage_tendsto_metProjection
    {μ : Measure Ω} [IsProbabilityMeasure μ] (T : Ω → Ω)
    (hT : MeasurePreserving T μ μ) (f : Lp ℝ 2 μ) :
    Tendsto (fun n => birkhoffAverage ℝ (koopman T hT) _root_.id n f)
      atTop (nhds (metProjection T hT f))
\end{lstlisting}

\subsection{Summary}

\begin{center}
\begin{tabular}{cll}
\textbf{Snippet} & \textbf{Content} & \textbf{File} \\
\hline
1 & Exchangeable & Contractability.lean \\
2 & Contractable & Contractability.lean \\
3 & ConditionallyIID & ConditionallyIID.lean \\
4 & deFinetti & TheoremViaMartingale.lean \\
5 & Full equivalence & TheoremViaMartingale.lean \\
9 & Directing measure & DirectingMeasure.lean \\
12 & Tail shift & TailSigma.lean \\
13 & Koopman operator & KoopmanMeanErgodic.lean \\
14 & Mean Ergodic Theorem & KoopmanMeanErgodic.lean \\
\end{tabular}
\end{center}
