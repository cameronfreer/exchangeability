---
Repo: https://github.com/cameronfreer/exchangeability
Commit: aec253b69aaabbd93dd82fe1a7d9bbf34cf90ab5
Date: 2026-01-24
Built: yes
Lean: v4.27.0-rc1
Lake: v5.0.0-src+2fcce72
---

# Infrastructure: Tail Ïƒ-Algebra, Conditional Expectation, and Kernels

## Overview

This document catalogs the measure-theoretic infrastructure supporting the de Finetti proofs, distinguishing between:
- **Repo-specific constructions** (built for this formalization)
- **mathlib components** (imported from mathlib)

## Tail Ïƒ-Algebra

### Repo-Specific

**File:** `Exchangeability/Tail/TailSigma.lean:56-61`

```lean
/-- The `n`-th reverse (future) Ïƒ-algebra generated by the tails of `X`. -/
def tailFamily (X : â„• â†’ Î© â†’ Î±) (n : â„•) : MeasurableSpace Î© :=
  iSup (fun k : â„• => MeasurableSpace.comap (fun Ï‰ => X (n + k) Ï‰) inferInstance)

/-- Tail Ïƒ-algebra of a process `X : â„• â†’ Î© â†’ Î±`. -/
def tailProcess (X : â„• â†’ Î© â†’ Î±) : MeasurableSpace Î© :=
  iInf (tailFamily X)
```

**File:** `Exchangeability/Tail/TailSigma.lean:88`

```lean
/-- Tail Ïƒ-algebra on path space `(â„• â†’ Î±)` defined via one-sided shifts. -/
def tailShift (Î± : Type*) [MeasurableSpace Î±] : MeasurableSpace (â„• â†’ Î±) :=
  iInf (fun n : â„• =>
    MeasurableSpace.comap
      (fun (Ï‰ : â„• â†’ Î±) => fun k => Ï‰ (n + k))
      (inferInstance : MeasurableSpace (â„• â†’ Î±)))
```

**File:** `Exchangeability/DeFinetti/CommonEnding.lean:121`

```lean
/-- A function on the path space is tail-measurable if it's measurable with respect
to the tail Ïƒ-algebra. -/
def IsTailMeasurable {Î± Î² : Type*} [MeasurableSpace Î±] [MeasurableSpace Î²]
    (f : (â„• â†’ Î±) â†’ Î²) : Prop :=
  @Measurable (â„• â†’ Î±) Î² (tailSigmaAlgebra Î±) _ f
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `MeasurableSpace.comap` | `Mathlib.MeasureTheory.MeasurableSpace.Basic` |
| `iInf` (Ïƒ-algebra intersection) | `Mathlib.MeasureTheory.MeasurableSpace.Basic` |

---

## Conditional Expectation

### Repo-Specific

**File:** `Exchangeability/Probability/CondExp.lean`

Wrapper and convenience lemmas around mathlib's `condExp`.

**File:** `Exchangeability/Probability/CondExpHelpers.lean`

```lean
/-- Conditional expectation tower property. -/
theorem condExp_condExp_of_le
    (hm : m â‰¤ m') (f : Î© â†’ â„) :
    condExp m (condExp m' f) =áµ[Î¼] condExp m f
```

**File:** `Exchangeability/Probability/CondExpHelpers/Convergence.lean`

```lean
/-- Conditional expectations converge when Ïƒ-algebras decrease. -/
theorem condExp_tendsto_of_antitone
    (hm : Antitone m) (f : Î© â†’ â„) :
    Tendsto (fun n => condExp (m n) f) atTop (ğ“ (condExp (â¨… n, m n) f))
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `condExp` | `Mathlib.MeasureTheory.Function.ConditionalExpectation.Basic` |
| `condExp_ae_eq_condExp_of_sub_le` | `Mathlib.MeasureTheory.Function.ConditionalExpectation.Basic` |
| `integrable_condExp` | `Mathlib.MeasureTheory.Function.ConditionalExpectation.Indicator` |

---

## Probability Kernels

### Repo-Specific

**File:** `Exchangeability/Probability/ConditionalKernel/CondExpKernel.lean`

```lean
/-- Conditional expectation as a probability kernel. -/
def condExpKernel
    (Î¼ : Measure Î©) (X : Î© â†’ Î±) (â„± : MeasurableSpace Î©) : Î© â†’ Measure Î± :=
  fun Ï‰ => Measure.map X (condMeasure Î¼ â„± Ï‰)

theorem condExpKernel_isProb
    (hX : Measurable X) :
    âˆ€áµ Ï‰ âˆ‚Î¼, IsProbabilityMeasure (condExpKernel Î¼ X â„± Ï‰)
```

**File:** `Exchangeability/Probability/ConditionalKernel/JointLawEq.lean`

```lean
/-- Joint law equals kernel composition. -/
theorem jointLaw_eq_kernel_bind
    (X : Î© â†’ Î±) (Y : Î© â†’ Î²) :
    Measure.map (X, Y) Î¼ = (Measure.map X Î¼).bind (condDistrib Y X Î¼)
```

**File:** `Exchangeability/Probability/MeasureKernels.lean`

```lean
/-- Kernel from measure-valued function. -/
def kernelOfMeasurable (Î½ : Î© â†’ Measure Î±) (hÎ½ : (* measurability *)) : Kernel Î© Î±
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `Kernel` | `Mathlib.Probability.Kernel.Basic` |
| `condDistrib` | `Mathlib.Probability.Kernel.CondDistrib` |
| `condExpKernel` | `Mathlib.Probability.Kernel.Condexp` |
| `Kernel.comp` | `Mathlib.Probability.Kernel.Composition.Comp` |

---

## Martingale Convergence

### Repo-Specific

**File:** `Exchangeability/DeFinetti/ViaL2/MainConvergence.lean:796`

```lean
/-- Subsequential a.e. convergence from LÂ¹ convergence. -/
theorem reverse_martingale_subsequence_convergence
    {Î¼ : Measure Î©} [IsProbabilityMeasure Î¼]
    (alpha : â„• â†’ Î© â†’ â„) (alpha_inf : Î© â†’ â„)
    (h_alpha_meas : âˆ€ n, Measurable (alpha n))
    (h_alpha_inf_meas : Measurable alpha_inf)
    (h_integrable : âˆ€ n, Integrable (fun Ï‰ => alpha n Ï‰ - alpha_inf Ï‰) Î¼)
    (h_L1_conv : âˆ€ Îµ > 0, âˆƒ N, âˆ€ n â‰¥ N, âˆ« Ï‰, |alpha n Ï‰ - alpha_inf Ï‰| âˆ‚Î¼ < Îµ) :
    âˆƒ (Ï† : â„• â†’ â„•), StrictMono Ï† âˆ§
      âˆ€áµ Ï‰ âˆ‚Î¼, Tendsto (fun k => alpha (Ï† k) Ï‰) atTop (ğ“ (alpha_inf Ï‰))
```

**File:** `Exchangeability/Probability/Martingale/Convergence.lean`

Convergence lemmas building on mathlib's martingale infrastructure.

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `Martingale` | `Mathlib.Probability.Martingale.Basic` |
| `Submartingale.ae_tendsto_limitProcess` | `Mathlib.Probability.Martingale.Convergence` |

---

## Conditional Independence

### Repo-Specific

**File:** `Exchangeability/Probability/CondIndep/Basic.lean:79`

```lean
/-- Conditional independence of Y and Z given W.
Y and Z are conditionally independent given W if:
  E[1_A(Y) Â· 1_B(Z) | Ïƒ(W)] = E[1_A(Y) | Ïƒ(W)] Â· E[1_B(Z) | Ïƒ(W)] a.e.
for all measurable sets A, B. -/
def CondIndep {Î© Î± Î² Î³ : Type*}
    [MeasurableSpace Î©] [MeasurableSpace Î±] [MeasurableSpace Î²] [MeasurableSpace Î³]
    (Î¼ : Measure Î©) (Y : Î© â†’ Î±) (Z : Î© â†’ Î²) (W : Î© â†’ Î³) : Prop :=
  âˆ€ (A : Set Î±) (B : Set Î²), MeasurableSet A â†’ MeasurableSet B â†’
    Î¼[ (Set.indicator (Y â»Â¹' A) (fun _ => (1 : â„))) *
       (Set.indicator (Z â»Â¹' B) (fun _ => (1 : â„)))
       | MeasurableSpace.comap W (by infer_instance) ]
      =áµ[Î¼]
    Î¼[ Set.indicator (Y â»Â¹' A) (fun _ => (1 : â„))
       | MeasurableSpace.comap W (by infer_instance) ]
    * Î¼[ Set.indicator (Z â»Â¹' B) (fun _ => (1 : â„))
       | MeasurableSpace.comap W (by infer_instance) ]
```

**File:** `Exchangeability/Probability/CondIndep/KallenbergIndicator.lean`

Lemmas connecting contractability to conditional independence, following Kallenberg's Lemma 1.3.

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `ProbabilityTheory.iIndep` | `Mathlib.Probability.Independence.Basic` |
| (conditional independence not yet in mathlib) | â€” |

---

## Ergodic Theory

### Repo-Specific

**File:** `Exchangeability/Ergodic/KoopmanMeanErgodic.lean:120`

```lean
/-- Koopman operator on LÂ². -/
def koopman {Î¼ : Measure Î©} [IsProbabilityMeasure Î¼] (T : Î© â†’ Î©) (hT : MeasurePreserving T Î¼ Î¼) :
    Lp â„ 2 Î¼ â†’L[â„] Lp â„ 2 Î¼ :=
  (MeasureTheory.Lp.compMeasurePreservingâ‚—áµ¢ â„ T hT).toContinuousLinearMap
```

**File:** `Exchangeability/Ergodic/KoopmanMeanErgodic.lean:245`

```lean
/-- Mean Ergodic Theorem: Birkhoff averages converge in LÂ² to the orthogonal projection. -/
theorem birkhoffAverage_tendsto_metProjection
    {Î¼ : Measure Î©} [IsProbabilityMeasure Î¼] (T : Î© â†’ Î©)
    (hT : MeasurePreserving T Î¼ Î¼) (f : Lp â„ 2 Î¼) :
    Tendsto (fun n => birkhoffAverage â„ (koopman T hT) _root_.id n f)
      atTop (ğ“ (metProjection T hT f))
```

**File:** `Exchangeability/Ergodic/InvariantSigma.lean`

Contains shift-invariant Ïƒ-algebra constructions and `metProjectionShift_tendsto`.

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `MeasurePreserving` | `Mathlib.Dynamics.Ergodic.MeasurePreserving` |
| `Ergodic` | `Mathlib.Dynamics.Ergodic.Ergodic` |

---

## Summary: Repo vs mathlib

| Category | Repo-Specific | mathlib |
|----------|--------------|---------|
| Tail Ïƒ-algebra | `tailShift`, `tailProcess`, `IsTailMeasurable` | `comap`, `iInf` |
| CondExp | Helpers, convergence | `condExp` core |
| Kernels | Kernel utilities | `Kernel`, `condDistrib`, `condExpKernel` |
| Martingales | Subsequential convergence | Forward martingale basics |
| Cond. Indep. | `CondIndep` and lemmas | `iIndep` (unconditional) |
| Ergodic | `koopman`, `birkhoffAverage_tendsto_metProjection` | `MeasurePreserving` |
