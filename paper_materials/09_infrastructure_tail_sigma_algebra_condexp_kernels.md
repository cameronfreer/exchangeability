---
Repo: https://github.com/human-oriented/exchangeability
Commit: aec253b69aaabbd93dd82fe1a7d9bbf34cf90ab5
Date: 2026-01-24
Built: yes
Lean: v4.27.0-rc1
Lake: v5.0.0-src+2fcce72
---

# Infrastructure: Tail œÉ-Algebra, Conditional Expectation, and Kernels

## Overview

This document catalogs the measure-theoretic infrastructure supporting the de Finetti proofs, distinguishing between:
- **Repo-specific constructions** (built for this formalization)
- **mathlib components** (imported from mathlib)

## Tail œÉ-Algebra

### Repo-Specific

**File:** `Exchangeability/Tail/TailSigma.lean`

```lean
/-- Tail shift œÉ-algebra: the œÉ-algebra generated by tail events. -/
def tailShift (Œ± : Type*) [MeasurableSpace Œ±] : MeasurableSpace (‚Ñï ‚Üí Œ±) :=
  ‚®Ö n : ‚Ñï, MeasurableSpace.comap (shift^[n]) inferInstance

/-- A set is tail-measurable iff it's measurable w.r.t. tailShift. -/
def IsTailMeasurable {Œ± : Type*} [MeasurableSpace Œ±] (s : Set (‚Ñï ‚Üí Œ±)) : Prop :=
  @MeasurableSet (‚Ñï ‚Üí Œ±) (tailShift Œ±) s
```

**File:** `Exchangeability/Tail/CondExpShiftInvariance.lean`

```lean
/-- Conditional expectation given the tail is shift-invariant. -/
theorem condExp_tail_shift_invariant
    (f : (‚Ñï ‚Üí Œ±) ‚Üí ‚Ñù) (hf : Integrable f Œº) :
    condExp (tailShift Œ±) f ‚àò shift =·µê[Œº] condExp (tailShift Œ±) f
```

**File:** `Exchangeability/Tail/ShiftInvariantMeasure.lean`

```lean
/-- The measure Œº restricted to the tail œÉ-algebra. -/
def tailMeasure (Œº : Measure (‚Ñï ‚Üí Œ±)) : Measure (‚Ñï ‚Üí Œ±) :=
  @Measure.trim (‚Ñï ‚Üí Œ±) (tailShift Œ±) _ Œº
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `MeasurableSpace.comap` | `Mathlib.MeasureTheory.MeasurableSpace.Basic` |
| `iInf` (œÉ-algebra intersection) | `Mathlib.MeasureTheory.MeasurableSpace.Basic` |

---

## Conditional Expectation

### Repo-Specific

**File:** `Exchangeability/Probability/CondExp.lean`

Wrapper and convenience lemmas around mathlib's `condExp`.

**File:** `Exchangeability/Probability/CondExpHelpers.lean`

```lean
/-- Conditional expectation tower property. -/
theorem condExp_condExp_of_le
    (hm : m ‚â§ m') (f : Œ© ‚Üí ‚Ñù) :
    condExp m (condExp m' f) =·µê[Œº] condExp m f
```

**File:** `Exchangeability/Probability/CondExpHelpers/Convergence.lean`

```lean
/-- Conditional expectations converge when œÉ-algebras decrease. -/
theorem condExp_tendsto_of_antitone
    (hm : Antitone m) (f : Œ© ‚Üí ‚Ñù) :
    Tendsto (fun n => condExp (m n) f) atTop (ùìù (condExp (‚®Ö n, m n) f))
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `condExp` | `Mathlib.MeasureTheory.Function.ConditionalExpectation.Basic` |
| `condExp_ae_eq_condExp_of_sub_le` | `Mathlib.MeasureTheory.Function.ConditionalExpectation.Basic` |
| `integrable_condExp` | `Mathlib.MeasureTheory.Function.ConditionalExpectation.Indicator` |

---

## Probability Kernels

### Repo-Specific

**File:** `Exchangeability/Probability/ConditionalKernel/CondExpKernel.lean`

```lean
/-- Conditional expectation as a probability kernel. -/
def condExpKernel
    (Œº : Measure Œ©) (X : Œ© ‚Üí Œ±) (‚Ñ± : MeasurableSpace Œ©) : Œ© ‚Üí Measure Œ± :=
  fun œâ => Measure.map X (condMeasure Œº ‚Ñ± œâ)

theorem condExpKernel_isProb
    (hX : Measurable X) :
    ‚àÄ·µê œâ ‚àÇŒº, IsProbabilityMeasure (condExpKernel Œº X ‚Ñ± œâ)
```

**File:** `Exchangeability/Probability/ConditionalKernel/JointLawEq.lean`

```lean
/-- Joint law equals kernel composition. -/
theorem jointLaw_eq_kernel_bind
    (X : Œ© ‚Üí Œ±) (Y : Œ© ‚Üí Œ≤) :
    Measure.map (X, Y) Œº = (Measure.map X Œº).bind (condDistrib Y X Œº)
```

**File:** `Exchangeability/Probability/MeasureKernels.lean`

```lean
/-- Kernel from measure-valued function. -/
def kernelOfMeasurable (ŒΩ : Œ© ‚Üí Measure Œ±) (hŒΩ : (* measurability *)) : Kernel Œ© Œ±
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `Kernel` | `Mathlib.Probability.Kernel.Basic` |
| `condDistrib` | `Mathlib.Probability.Kernel.CondDistrib` |
| `condExpKernel` | `Mathlib.Probability.Kernel.Condexp` |
| `Kernel.comp` | `Mathlib.Probability.Kernel.Composition.Comp` |

---

## Martingale Convergence

### Repo-Specific

**File:** `Exchangeability/Probability/Martingale/Reverse.lean`

```lean
/-- Reverse martingale convergence theorem. -/
theorem reverse_martingale_ae_tendsto
    (hM : ReverseMartingale Œº M ‚Ñ±)
    (hBdd : ‚àÄ n, snorm (M n) 1 Œº ‚â§ C) :
    ‚àÉ M_‚àû, Tendsto (M n) atTop (ùìù M_‚àû) a.e.
```

**File:** `Exchangeability/Probability/Martingale/Crossings.lean`

```lean
/-- Upcrossing inequality for reverse martingales. -/
theorem reverse_upcrossing_bound
    (hM : ReverseMartingale Œº M ‚Ñ±) :
    ùîº[upcrossings a b M n] ‚â§ ùîº[(M 0 - a)‚Å∫] / (b - a)
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `Martingale` | `Mathlib.Probability.Martingale.Basic` |
| `Submartingale.ae_tendsto_limitProcess` | `Mathlib.Probability.Martingale.Convergence` |

---

## Conditional Independence

### Repo-Specific

**File:** `Exchangeability/Probability/CondIndep.lean`

```lean
/-- Conditional independence given a œÉ-algebra. -/
def CondIndep (Œº : Measure Œ©) (X Y : Œ© ‚Üí Œ±) (‚Ñ± : MeasurableSpace Œ©) : Prop :=
  ‚àÄ A B, MeasurableSet A ‚Üí MeasurableSet B ‚Üí
    condExp ‚Ñ± (1_A ‚àò X * 1_B ‚àò Y) =·µê[Œº] condExp ‚Ñ± (1_A ‚àò X) * condExp ‚Ñ± (1_B ‚àò Y)
```

**File:** `Exchangeability/Probability/CondIndep/KallenbergIndicator.lean`

```lean
/-- Kallenberg Lemma 1.3: Contraction implies conditional independence. -/
theorem condIndep_of_contraction
    (hLaw : Law (Y, W) Œº = Law (Y, W') Œº)
    (hSub : œÉ(W) ‚â§ œÉ(W')) :
    CondIndep Œº Y W' œÉ(W)
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `ProbabilityTheory.iIndep` | `Mathlib.Probability.Independence.Basic` |
| (conditional independence not yet in mathlib) | ‚Äî |

---

## Ergodic Theory

### Repo-Specific

**File:** `Exchangeability/Ergodic/KoopmanMeanErgodic.lean`

```lean
/-- Koopman operator on L¬≤. -/
def koopmanOp (T : Œ© ‚Üí Œ©) (hT : MeasurePreserving T Œº) :
    Lp ‚Ñù 2 Œº ‚ÜíL[‚Ñù] Lp ‚Ñù 2 Œº

/-- Mean Ergodic Theorem. -/
theorem mean_ergodic_L2
    (f : Lp ‚Ñù 2 Œº) :
    Tendsto (cesaro (koopmanOp T hT) f) atTop (ùìù (invariantProj T hT f))
```

**File:** `Exchangeability/Ergodic/InvariantSigma.lean`

```lean
/-- Shift-invariant œÉ-algebra. -/
def shiftInvariantSigma (Œ± : Type*) [MeasurableSpace Œ±] : MeasurableSpace (‚Ñï ‚Üí Œ±) :=
  { s | shift ‚Åª¬π' s = s }.measurableSpace
```

### mathlib Components

| Component | mathlib Location |
|-----------|-----------------|
| `MeasurePreserving` | `Mathlib.Dynamics.Ergodic.MeasurePreserving` |
| `Ergodic` | `Mathlib.Dynamics.Ergodic.Ergodic` |

---

## Summary: Repo vs mathlib

| Category | Repo-Specific | mathlib |
|----------|--------------|---------|
| Tail œÉ-algebra | `tailShift`, `IsTailMeasurable` | `comap`, `iInf` |
| CondExp | Helpers, convergence | `condExp` core |
| Kernels | `condExpKernel`, `kernelOfMeasurable` | `Kernel`, `condDistrib` |
| Martingales | Reverse convergence, crossings | Forward martingale basics |
| Cond. Indep. | Full definition and lemmas | `iIndep` (unconditional) |
| Ergodic | Mean ergodic, Koopman | `MeasurePreserving` |
