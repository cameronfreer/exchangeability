# Detailed Explanation of 6 Remaining Axioms

## Overview

All 6 axioms are in `Exchangeability/DeFinetti/ViaMartingale.lean`. Here's the dependency chain:

```
condexp_convergence (line 488)
       ‚Üì
extreme_members_equal_on_tail (sorry at line 507)
       ‚Üì
coordinate_future_condIndep (line 1572) ‚Üê PROBLEMATIC!
       ‚Üì
finite_level_factorization (line 1610)
       ‚Üì
tail_factorization_from_future (line 1784)
       ‚Üì
directingMeasure_of_contractable (line 1867)
       ‚Üì
finite_product_formula (line 1911)
       ‚Üì
deFinetti_viaMartingale (sorry at line 1849)
```

---

## AXIOM 1: `condexp_convergence` (LINE 488)

### Mathematical Statement

For a contractable sequence X and any k ‚â§ m:
```
E[1_{X_m ‚àà B} | œÉ(Œ∏_{m+1} X)] = E[1_{X_k ‚àà B} | œÉ(Œ∏_{m+1} X)]  a.e.
```

where `Œ∏_n X` denotes the shift: `(Œ∏_n X)_i = X_{n+i}`.

### Current Code

```lean
axiom condexp_convergence
    {Œº : Measure Œ©} [IsProbabilityMeasure Œº]
    {X : ‚Ñï ‚Üí Œ© ‚Üí Œ±} (hX : Contractable Œº X)
    (hX_meas : ‚àÄ n, Measurable (X n))
    (k m : ‚Ñï) (hk : k ‚â§ m)
    (B : Set Œ±) (hB : MeasurableSet B) :
    Œº[Set.indicator B (fun _ => (1 : ‚Ñù)) ‚àò (X m) | futureFiltration X m]
      =·µê[Œº]
    Œº[Set.indicator B (fun _ => (1 : ‚Ñù)) ‚àò (X k) | futureFiltration X m]
```

where:
```lean
def shiftRV (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±) (m : ‚Ñï) : Œ© ‚Üí (‚Ñï ‚Üí Œ±) :=
  fun œâ n => X (m + n) œâ

abbrev futureFiltration (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±) (m : ‚Ñï) : MeasurableSpace Œ© :=
  MeasurableSpace.comap (shiftRV X (m + 1)) inferInstance
```

So `futureFiltration X m = œÉ(X_{m+1}, X_{m+2}, ...)`.

### Why It's Needed

This is Kallenberg's "Lemma 1.3" (contraction-independence): it says that all coordinates look the same when you condition on the future. This is the key step that lets you replace X_m with X_k in conditional expectations.

### The Blocker

**Depends on:** `condexp_indicator_eq_of_agree_on_future_rectangles` in CondExp.lean:120 (which is itself a sorry!)

**Proof strategy (from comments):**

1. **Contractability gives distributional equality:**
   - Since k ‚â§ m, contractability says the subsequences (X_k, X_{k+1}, ..., X_m) and (X_0, X_1, ..., X_{m-k}) have the same distribution
   - This implies (X_k, Œ∏_{m+1} X) and (X_m, Œ∏_{m+1} X) have the same distribution

2. **Apply distributional invariance:**
   - Use `condexp_indicator_eq_of_agree_on_future_rectangles` to conclude:
   ```
   E[1_{X_k ‚àà B} | œÉ(Œ∏_{m+1} X)] = E[1_{X_m ‚àà B} | œÉ(Œ∏_{m+1} X)]
   ```

3. **Problem:** The lemma `condexp_indicator_eq_of_agree_on_future_rectangles` is a sorry due to typeclass issues with `MeasurableSpace.comap`.

### How to Resolve

**Option A: Prove condexp_indicator_eq_of_agree_on_future_rectangles**
- The mathematical proof is documented at CondExp.lean:108-117
- Need to handle typeclass inference with sub-œÉ-algebras
- Key lemma from mathlib: `ae_eq_condExp_of_forall_setIntegral_eq`

**Option B: Direct proof from contractability**
- Prove directly that contractability implies the conditional expectations are equal
- May need to develop theory of conditional expectation under distributional equality

**Option C: Use Martingale.lean axioms**
- The reverse martingale convergence is already axiomatized in Martingale.lean
- Could potentially derive this from those axioms

---

## AXIOM 2: `coordinate_future_condIndep` (LINE 1572) ‚ö†Ô∏è PROBLEMATIC

### Mathematical Statement (AS CLAIMED)

The docstring says:
> "For contractable sequences, X_i and the future shift are conditionally independent given any later future filtration."

And the comment at line 1690 says:
> "X_i and shiftRV X (m+1) are conditionally independent given futureFiltration X m"

### Current Code

```lean
axiom coordinate_future_condIndep
    {Œ© Œ± : Type*} [MeasurableSpace Œ©] [StandardBorelSpace Œ©] [MeasurableSpace Œ±]
    {Œº : Measure Œ©} [IsProbabilityMeasure Œº]
    (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±)
    (hX : Contractable Œº X)
    (hX_meas : ‚àÄ n, Measurable (X n))
    (i m : ‚Ñï) (hm : m > i) : True
  -- TODO: Full type with CondIndep blocked by typeclass resolution
```

### THE PROBLEM: This Statement Makes No Sense! üö®

**By definition:**
```lean
futureFiltration X m = MeasurableSpace.comap (shiftRV X (m + 1)) inferInstance
                     = œÉ(X_{m+1}, X_{m+2}, ...)
```

**The claim is:**
```
X_i ‚ä•‚ä•_{futureFiltration X m} shiftRV X (m+1)
```

**But this is nonsense because:**
- `shiftRV X (m+1)` is the entire future sequence starting at m+1
- `futureFiltration X m` is the œÉ-algebra generated by `shiftRV X (m+1)`
- You can't be conditionally independent of Y given œÉ(Y)!

### What It SHOULD Be

Looking at how it's used (line 1690), the proof needs something like:

**For contractable X, when r < m:**
```
œÉ(X_0, ..., X_r) ‚ä•‚ä•_{œÉ(Œ∏_{m+1} X)} œÉ(X_r)
```

or more generally:

**Past coordinates and individual coordinates are conditionally independent given the far future.**

But the exact formulation is unclear from Kallenberg.

### How to Resolve

**Option A: Consult Kallenberg (2005)**
- Read the third proof of Theorem 1.1 carefully
- Identify what consequence of contractability is actually being invoked
- Reformulate the axiom with the correct statement

**Option B: Redesign the proof**
- The commented proof at lines 1620-1750 tries to use this
- May need a completely different approach
- Perhaps the proof doesn't actually need conditional independence in this form

**Option C: Ask experts**
- Post on Lean Zulip or MathOverflow
- "What independence property follows from contractability that would help factor conditional expectations?"

**RECOMMENDATION:** This is the highest priority issue because it's blocking `finite_level_factorization` and suggests the proof strategy may be fundamentally wrong.

---

## AXIOM 3: `finite_level_factorization` (LINE 1610)

### Mathematical Statement

For contractable X and m ‚â• r:
```
E[‚àè_{i<r} 1_{X_i ‚àà C_i} | œÉ(Œ∏_{m+1} X)] = ‚àè_{i<r} E[1_{X_0 ‚àà C_i} | œÉ(Œ∏_{m+1} X)]  a.e.
```

That is: conditional on the future, the product of indicators factors.

### Current Code

```lean
axiom finite_level_factorization
    {Œ© Œ± : Type*} [MeasurableSpace Œ©] [StandardBorelSpace Œ©] [MeasurableSpace Œ±]
    {Œº : Measure Œ©} [IsProbabilityMeasure Œº]
    (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±)
    (hX : Contractable Œº X)
    (hX_meas : ‚àÄ n, Measurable (X n))
    (r : ‚Ñï) (C : Fin r ‚Üí Set Œ±) (hC : ‚àÄ i, MeasurableSet (C i))
    (m : ‚Ñï) (hm : m ‚â• r) : True
  -- TODO: Prove factorization via induction on r
```

### Why It's Needed

This is the key step showing that conditional on the future, the past coordinates "look independent". Combined with `condexp_convergence` (which swaps X_i with X_0), this proves conditional i.i.d.

### The Blocker

**There's a detailed proof sketch at lines 1620-1750!** It's ~80% complete but blocked at two points:

1. **Line 1674:** Tries to prove measurability using the removed `firstRSigma_le_futureFiltration` lemma
   - This is fixable - the measurability comes from independence, not inclusion

2. **Line 1692:** Tries to derive conditional independence from `coordinate_future_condIndep`
   - This is the real blocker
   - The sorry says: "This is non-trivial and requires developing the theory of conditional independence"

### How to Resolve

**Depends on resolving Axiom 2 (`coordinate_future_condIndep`)!**

Once that's fixed:
1. Uncomment the proof sketch (lines 1620-1750)
2. Fix the measurability argument at line 1674
3. Use the corrected `coordinate_future_condIndep` at line 1692
4. Debug any remaining issues

The proof structure is:
- **Base case (r=0):** Empty product is 1, trivial
- **Inductive step:** Factor ‚àè_{i‚â§r} = (‚àè_{i<r}) ¬∑ 1_{X_r ‚àà C_r}
  - Use conditional independence to factor the product
  - Use `condexp_convergence` to replace X_r with X_0
  - Apply induction hypothesis to ‚àè_{i<r}

---

## AXIOM 4: `tail_factorization_from_future` (LINE 1784)

### Mathematical Statement

The factorization from `finite_level_factorization` extends to the tail œÉ-algebra:
```
E[‚àè_{i<r} 1_{X_i ‚àà C_i} | tailœÉ(X)] = ‚àè_{i<r} E[1_{X_0 ‚àà C_i} | tailœÉ(X)]  a.e.
```

where `tailœÉ(X) = ‚ãÇ_n œÉ(Œ∏_n X)`.

### Current Code

```lean
axiom tail_factorization_from_future
    {Œ© Œ± : Type*} [MeasurableSpace Œ©] [StandardBorelSpace Œ©] [MeasurableSpace Œ±]
    {Œº : Measure Œ©} [IsProbabilityMeasure Œº]
    (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±)
    (hX : Contractable Œº X)
    (hX_meas : ‚àÄ n, Measurable (X n))
    (r : ‚Ñï) (C : Fin r ‚Üí Set Œ±) (hC : ‚àÄ i, MeasurableSet (C i)) :
    Œº[indProd X r C | tailSigma X]
      =·µê[Œº]
    (fun œâ => ‚àè i, Œº[Set.indicator (C i) (fun _ => (1:‚Ñù)) ‚àò X 0 | tailSigma X] œâ)
```

### Why It's Needed

This extends the finite factorization to the limit. Combined with the fact that conditional expectations on the tail œÉ-algebra are constant, this gives conditional i.i.d.

### The Blocker

**Proof strategy:**

1. Apply `finite_level_factorization` to get factorization on `futureFiltration X m` for each m
2. Note that `futureFiltration X m` is decreasing: ... ‚äÜ œÉ(Œ∏_{m+1} X) ‚äÜ œÉ(Œ∏_m X) ‚äÜ ...
3. As m ‚Üí ‚àû, these decrease to `tailSigma X = ‚ãÇ_m futureFiltration X m`
4. Use reverse martingale convergence: conditional expectations converge

**Dependencies:**
- `finite_level_factorization` (Axiom 3)
- Reverse martingale convergence (axiomatized in Martingale.lean or needs proof)
- Conditional expectation convergence along decreasing filtrations

### How to Resolve

**After Axiom 3 is proven:**

1. Apply `finite_level_factorization` for each m
2. Use `Exchangeability.Probability.reverseMartingale_convergence_ae` from Martingale.lean
3. Pass to the limit using monotone/dominated convergence

**Difficulty:** Medium - should be mechanical once Axiom 3 is done.

---

## AXIOM 5: `directingMeasure_of_contractable` (LINE 1867)

### Mathematical Statement

From a contractable sequence X, construct a probability measure ŒΩ on Œ± such that:
```
X is (Œº-almost surely) conditionally i.i.d. with directing measure ŒΩ
```

That is, ŒΩ is the "random law" that makes X conditionally i.i.d.

### Current Code

```lean
axiom directingMeasure_of_contractable
    {Œ© Œ± : Type*} [MeasurableSpace Œ©] [StandardBorelSpace Œ©] [MeasurableSpace Œ±]
    {Œº : Measure Œ©} [IsProbabilityMeasure Œº]
    (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±)
    (hX : Contractable Œº X)
    (hX_meas : ‚àÄ n, Measurable (X n)) :
    ‚àÉ (ŒΩ : Œ© ‚Üí Measure Œ±),
      (‚àÄ œâ, IsProbabilityMeasure (ŒΩ œâ)) ‚àß
      Measurable ŒΩ ‚àß
      (‚àÄ n B, MeasurableSet B ‚Üí
        Œº[Set.indicator B (fun _ => (1:‚Ñù)) ‚àò X n | tailSigma X]
          =·µê[Œº] fun œâ => (ŒΩ œâ) B)
```

### Why It's Needed

This constructs the directing measure ŒΩ : Œ© ‚Üí Measure Œ± that witnesses conditional i.i.d. The final step is showing that:
1. Coordinates are independent given ŒΩ (from the factorization)
2. Each coordinate has distribution ŒΩ(œâ) at œâ (from this axiom)

### The Blocker

**This requires the Ionescu-Tulcea extension theorem!**

**Proof strategy (from comments at lines 1857-1885):**

1. **Define conditional distributions:** For each œâ, set
   ```
   ŒΩ(œâ, B) = E[1_{X_0 ‚àà B} | tailSigma X](œâ)
   ```

2. **Show it's a probability measure:** Use properties of conditional expectation
   - ŒΩ(œâ, ‚àÖ) = 0
   - ŒΩ(œâ, Œ±) = 1
   - Countable additivity

3. **Show it's measurable:** This is the hard part
   - Need `ŒΩ : Œ© ‚Üí Measure Œ±` to be measurable
   - Requires machinery from `Exchangeability/Probability/InfiniteProduct.lean`
   - May need to extend that file

4. **Verify the property:** Show that
   ```
   E[1_{X_n ‚àà B} | tailSigma X](œâ) = ŒΩ(œâ, B)
   ```
   This follows from `extreme_members_equal_on_tail` (which is a sorry!)

### Dependencies

- `extreme_members_equal_on_tail` (sorry at line 507)
- `condexp_convergence` (Axiom 1)
- Ionescu-Tulcea extension theorem (may need to prove or extend InfiniteProduct.lean)

### How to Resolve

**Step 1:** Prove `extreme_members_equal_on_tail`
- Once `condexp_convergence` is proven
- Use reverse martingale convergence

**Step 2:** Develop conditional probability kernel machinery
- Extend `Exchangeability/Probability/InfiniteProduct.lean`
- Or search mathlib for `Measure.condDistrib` etc.

**Step 3:** Construct ŒΩ and verify properties
- Should be mostly mechanical once infrastructure is in place

**Difficulty:** Hard - requires substantial measure theory infrastructure.

---

## AXIOM 6: `finite_product_formula` (LINE 1911)

### Mathematical Statement

For finite products, the directing measure gives the right distributions:
```
Œº(X_0 ‚àà C_0, ..., X_{r-1} ‚àà C_{r-1})
  = ‚à´_Œ© (‚àè_i ŒΩ(œâ, C_i)) dŒº(œâ)
```

where ŒΩ is the directing measure from Axiom 5.

### Current Code

```lean
axiom finite_product_formula
    {Œ© Œ± : Type*} [MeasurableSpace Œ©] [StandardBorelSpace Œ©] [MeasurableSpace Œ±]
    {Œº : Measure Œ©} [IsProbabilityMeasure Œº]
    (X : ‚Ñï ‚Üí Œ© ‚Üí Œ±)
    (hX : Contractable Œº X)
    (hX_meas : ‚àÄ n, Measurable (X n))
    (ŒΩ : Œ© ‚Üí Measure Œ±)
    (hŒΩ_prob : ‚àÄ œâ, IsProbabilityMeasure (ŒΩ œâ))
    (hŒΩ_meas : Measurable ŒΩ)
    (hŒΩ_prop : ‚àÄ n B, MeasurableSet B ‚Üí
      Œº[Set.indicator B (fun _ => (1:‚Ñù)) ‚àò X n | tailSigma X]
        =·µê[Œº] fun œâ => (ŒΩ œâ) B)
    (r : ‚Ñï) (C : Fin r ‚Üí Set Œ±) (hC : ‚àÄ i, MeasurableSet (C i)) :
    Œº (firstRCylinder X r C)
      = ‚à´ œâ, (‚àè i, (ŒΩ œâ) (C i)) ‚àÇŒº
```

### Why It's Needed

This is the final step: showing that the directing measure ŒΩ actually gives the finite-dimensional distributions of X.

### The Blocker

**Proof strategy:**

1. Compute the left side:
   ```
   Œº(X_0 ‚àà C_0, ..., X_{r-1} ‚àà C_{r-1})
   = ‚à´_Œ© 1_{X_0 ‚àà C_0, ..., X_{r-1} ‚àà C_{r-1}} dŒº
   = ‚à´_Œ© E[‚àè_i 1_{X_i ‚àà C_i} | tailSigma X] dŒº  (tower property)
   ```

2. Apply `tail_factorization_from_future` (Axiom 4):
   ```
   = ‚à´_Œ© ‚àè_i E[1_{X_i ‚àà C_i} | tailSigma X] dŒº
   ```

3. Use property of ŒΩ (from Axiom 5):
   ```
   = ‚à´_Œ© ‚àè_i ŒΩ(œâ, C_i) dŒº
   ```

### Dependencies

- `tail_factorization_from_future` (Axiom 4)
- `directingMeasure_of_contractable` (Axiom 5)
- Tower property and Fubini for conditional expectations

### How to Resolve

**After Axioms 4 and 5 are proven:**

This should follow mechanically by:
1. Applying the tower property
2. Using Axiom 4 to factor
3. Using the defining property of ŒΩ from Axiom 5
4. Using Fubini/product measure properties

**Difficulty:** Easy/Medium once dependencies are resolved.

---

## Summary: Resolution Order

### Priority 1: FIX AXIOM 2! üö®

**`coordinate_future_condIndep`** is mathematically unclear/incorrect. Everything depends on clarifying this.

**Action items:**
1. Read Kallenberg (2005) Section 1, third proof of Theorem 1.1
2. Identify what independence property is actually needed
3. Reformulate the axiom with correct statement
4. OR redesign the proof to not use this

### Priority 2: PROVE AXIOM 1

**`condexp_convergence`** blocks `extreme_members_equal_on_tail` which blocks Axiom 5.

**Action items:**
1. Prove `condexp_indicator_eq_of_agree_on_future_rectangles` in CondExp.lean
2. OR prove `condexp_convergence` directly from contractability
3. OR use axioms from Martingale.lean

### Priority 3: COMPLETE AXIOM 3

**`finite_level_factorization`** has a detailed proof sketch that's ~80% done.

**Action items:**
1. Fix Axiom 2 first (this depends on it)
2. Uncomment proof sketch
3. Fix measurability argument (line 1674)
4. Fill in conditional independence derivation (line 1692)
5. Debug remaining issues

### Priority 4: PROVE REMAINING AXIOMS IN ORDER

Once Axioms 1-3 are done:
- Axiom 4 (`tail_factorization_from_future`) follows from Axiom 3 + martingale convergence
- Axiom 5 (`directingMeasure_of_contractable`) follows from Axiom 1 + Ionescu-Tulcea
- Axiom 6 (`finite_product_formula`) follows mechanically from Axioms 4 + 5

---

## Questions for You

1. **Do you have access to Kallenberg (2005)?** Specifically, can you read the third proof of Theorem 1.1 (pages 27-28) to understand what `coordinate_future_condIndep` should actually state?

2. **What's your level of comfort with:**
   - Conditional expectation theory?
   - Martingale convergence theorems?
   - Ionescu-Tulcea extension?

3. **What would you like to focus on first?**
   - Fixing the mathematical formulation (Axiom 2)?
   - Proving conditional expectation results (Axiom 1)?
   - Completing the proof sketch (Axiom 3)?
   - Something else?

Let me know and I can help in whatever direction you choose!
